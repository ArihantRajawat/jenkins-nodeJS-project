<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{user/base :: layout(~{::title}, ~{:: content})}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
</head>

<body>
    <div th:fragment="content">
        <!-- Registeration start -->
        <div class="register">
            <div class="container">
                <div class="row">
                    <div class="col-md-5" style="margin-top: 50px;">
                        <div class="title">
                            <p style="color: #00984a; margin-bottom: -48px;">Welcome to Registration Portal!</p>
                        </div>
                        <img width="95%" src="/assets/img/phlebotomist.svg">
                    </div>

                    <div class="col-md-7 register-form" style="margin: auto;">
                        <div class="form-content pt-2" style="margin: 50px 0;">
                            <div class="text-center">
                                <p class="title">Registration</p>
                            </div>

                            <p class="text-center">Please fill out the form and register to our site.</p>
                            <form id="register-form" action="">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>Firstname<span class="field-required">*</span></label>
                                        <div class="field">
                                            <input type="text" class="form-control form-control-sm" id="firstname"
                                                name="firstname" placeholder="Enter your firstname">
                                            <span id="firstnameError" class="error"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Lastname<span class="field-required">*</span></label>
                                        <div class="field">
                                            <input type="text" class="form-control form-control-sm" id="lastname"
                                                name="lastname" placeholder="Enter your lastname">
                                            <span id="lastnameError" class="error"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <label>Phone Number<span class="field-required">*</span></label>
                                        <div class="field">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text" id="inputGroup-sizing-sm" style="margin-bottom: 1px;
                                                z-index: 9;
                                                border: none;
                                                border-right: 1px solid #dddddd;
                                                font-weight: 500;
                                                margin-top: 1px;
                                                position: relative;">+91</span>
                                                <input name="phone" id="phone" type="text" maxlength="10"
                                                    pattern="[0-9]{10}" class="form-control"
                                                    aria-label="Sizing example input"
                                                    aria-describedby="inputGroup-sizing-sm"
                                                    placeholder="Enter your 10-Digit number" style="position: absolute;
                                                    width: 100%;
                                                    padding-left: 50px; border-radius: 4px;">
                                            </div>
                                            <span id="phoneError" class="error"></span>
                                        </div>
                                        <script>
                                            $(document).ready(function () {

                                                $('#phone').on('input', function () {
                                                    let phoneNumber = $(this).val();
                                                    let sanitizedInput = phoneNumber.replace(/\D/g, '');
                                                    $(this).val(sanitizedInput);
                                                })
                                            });
                                        </script>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Email Address<span class="field-required">*</span></label>
                                        <div class="field">
                                            <input type="email" class="form-control form-control-sm" id="email"
                                                name="email" placeholder="Enter your email address">
                                            <span id="emailError" class="error"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>Password<span class="field-required">*</span></label>
                                        <div class="field">
                                            <input type="password" class="form-control form-control-sm" id="password"
                                                name="password" placeholder="Enter your password">
                                            <span id="passwordError" class="error"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Confirm Password<span class="field-required">*</span></label>
                                        <div class="field">
                                            <div class="input-group" id="show_hide_password">
                                                <input style="border-radius: 4px;padding-right: 41px;"
                                                    class="form-control form-control-sm" type="password"
                                                    placeholder="Enter confirm password" name="confirmPassword"
                                                    id="confirmPassword">
                                                <div class="input-group-addon">
                                                    <a href="" style="padding: 8px; font-size: smaller;display: flex;"><i
                                                            class="fa fa-eye-slash" aria-hidden="true"
                                                            style="color: #202c45;"></i></a>
                                                </div>
                                            </div>
                                            <style>
                                                .show_hide_password a:hover{
                                                    text-decoration: none;
                                                }
                                            </style>
                                            <span id="confirmPasswordError" class="error"></span>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="field">
                                        <div class="form-check">
                                            <input class="form-check-input small" style="font-size: medium;"
                                                type="checkbox" name="check" id="check">
                                            <label class="form-check-label small" for="agree">
                                                I accept the <a href="#">terms and conditions</a>
                                            </label>
                                        </div>
                                        <span id="checkError" class="error"></span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn"><span id="btn-spinner"
                                            class="spinner-border d-none spinner-border-sm" role="status"
                                            aria-hidden="true"></span>&nbsp;Register</button>
                                    <button class="btn" type="reset">Reset</button>
                                </div>
                                <div class="col-md-12 small mt-3" style="text-align: center;">
                                    If you have an account? <a data-bs-toggle="modal" data-bs-target="#loginModel"
                                        href="#">Signin</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Registeration end -->


        <script>
            $(document).ready(function () {


                $('input').focus(function () {
                    $(this).removeClass('border-danger');
                    var fieldName = $(this).attr('name');
                    $('#' + fieldName + 'Error').text('');
                    $('#' + fieldName + 'Error').css({ 'background-image': 'none' });
                });


                $('#register-form').submit(function (event) {
                    event.preventDefault();
                    $('#btn-spinner').removeClass('d-none');
                    var formData = {
                        firstname: $('#firstname').val().trim(),
                        lastname: $('#lastname').val().trim(),
                        email: $('#email').val().trim(),
                        phone: $('#phone').val().trim(),
                        password: $('#password').val().trim(),
                        confirmPassword: $('#confirmPassword').val().trim(),
                        check: $('#check').is(':checked')
                    }
                    $.ajax({
                        type: 'POST',
                        url: '/register/save',
                        data: JSON.stringify(formData),
                        contentType: 'application/json',
                        success: function (response) {
                            showToast(response.message, 'bg-success');
                            $('#register-form')[0].reset();
                        },
                        error: function (xhr, status, error) {
                            if (xhr.status === 400) {
                                var errorMessage = xhr.responseJSON;
                                var fieldErrors = errorMessage.errors;
                                if (fieldErrors !== null) {
                                    $.each(fieldErrors, function (fieldName, errorMessage) {
                                        $('#' + fieldName + 'Error').css({ 'background-image': 'url("/assets/img/error-info.svg")' });
                                        $('#' + fieldName + 'Error').text(errorMessage);
                                        $('#' + fieldName).addClass('border-danger')
                                    });
                                }
                                showToast(errorMessage.message, 'bg-danger');
                            } else {
                                const data = JSON.parse(xhr.responseText);
                                showToast(data.message, 'bg-danger');
                            }

                        },
                        complete: function () {
                            $('#btn-spinner').addClass('d-none');
                        }
                    });
                });


                $("#show_hide_password a").on('click', function (event) {
                    event.preventDefault();
                    if ($('#show_hide_password input').attr("type") == "text") {
                        $('#show_hide_password input').attr('type', 'password');
                        $('#show_hide_password i').addClass("fa-eye-slash");
                        $('#show_hide_password i').removeClass("fa-eye");
                    } else if ($('#show_hide_password input').attr("type") == "password") {
                        $('#show_hide_password input').attr('type', 'text');
                        $('#show_hide_password i').removeClass("fa-eye-slash");
                        $('#show_hide_password i').addClass("fa-eye");
                    }
                });
            });
        </script>
    </div>
</body>

</html>